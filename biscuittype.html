<!DOCTYPE html>
<html lang="fr">
<head>
    <link rel="stylesheet" href="./css/stylecva.css">
    <script>
        // Fonction pour gérer la soumission du formulaire de recherche
        function onHandleSearch() {
            const searchBar = document.getElementById('search-bar');
            const query = searchBar.value.trim();
            if (query) {
                // Rediriger vers une nouvelle URL avec le terme de recherche comme paramètre de requête
                window.location.href = `index.html?search=${encodeURIComponent(query)}`;
            }
        }

        // Code existant pour récupérer les informations du produit
        document.addEventListener('DOMContentLoaded', (event) => {
            const searchParams = new URLSearchParams(window.location.search);
            const id = searchParams.get("id");
            if (id) {
                const url = `https://world.openfoodfacts.org/api/v3/product/${id}.json`;
                fetch(url).then(response => response.json()).then(response => {
                    console.log(response);
                    // title
                    const name = document.querySelector("#title");
                    name.innerHTML = response.product.product_name;

                    // image
                    const image_url = response.product.image_front_url;
                    const img = document.querySelector("#biscuit_img");
                    img.setAttribute("src", image_url);

                    // ingredients
                    const listIngredients = document.querySelector("#liste_ingredients");
                    listIngredients.innerHTML = response.product.ingredients.map(ingredient => {
                        return `<li>${ingredient.text.replaceAll("_", " ")}</li>`;
                    }).join("");

                    // allergènes
                    const listAllergenes = document.querySelector("#liste_allergenes");
                    listAllergenes.innerHTML = response.product.allergens_tags.map(allergen => {
                        return `<li>${allergen.replaceAll("en:", " ")}</li>`;
                    }).join("");
                });
            }
        });
    </script>
</head>
<body>
    <!-- head -->
    <div class="container_header">
        <a href="index.html">
            <div class="container_item">
                <img src="../image/home.png" alt="home">
            </div>
        </a>
        <a href="index.html">
            <div class="container_item">
                <img src="../image/title.png" alt="title" width="auto" height="75px">
            </div>
        </a>
        <div class="container_item">
            <form onsubmit="onHandleSearch(); return false;">
                <input type="search" id="search-bar" placeholder="Rechercher..." />
                <input type="submit" value="ok" />
            </form>
        </div>
        <div class="container_item">
            <img src="../image/filtre.png" alt="filtre">
        </div><br>
    </div><br><br><br>

    <!-- titre -->
    <h1 id="title"></h1>
    <div class="container_image">
        <img id="biscuit_img"/>
        <!-- liste ingredients -->
        <p><u>Ingrédients:</u></p>
        <ul id="liste_ingredients"></ul>
        <!-- liste allergenes -->
        <p><u>allergènes:</u></p>
        <ul id="liste_allergenes"></ul>
    </div>
    <div class="container_down">
        <a href="./napolitain.html"><img src="./image/left-arrow - Copie.png" alt="home"></a>
        <a href="./ours"><img src="./image/right-arrow.png" alt="home"></a> 
    </div>
</body>
</html>
